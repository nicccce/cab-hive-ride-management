# 认证接口文档

## 1. 微信用户登录

### 接口地址
`POST /api/auth/wechat/login`

### 请求参数
```json
{
  "code": "wx_temp_code_123",
  "encryptedData": "encrypted_user_data",
  "iv": "initialization_vector"
}
```

### 响应示例
```json
{
  "code": 200,
  "msg": "Login successful",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user_id": "user_123456",
    "role": "customer",
    "expires_in": 7200,
    "user_info": {
      "nickname": "张三",
      "avatar": "https://wx.qlogo.cn/...",
      "phone": "138****5678"
    }
  },
  "timestamp": "2025-07-16T10:30:00Z"
}
```

## 2. 司机注册

### 接口地址
`POST /api/auth/driver/register`

### 请求头
```
Authorization: Bearer <token>
```

### 请求参数
```json
{
  "license_number": "330100199001011234",
  "license_image": "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQ...",
  "name": "李四",
  "phone": "139****8765"
}
```

### 响应示例
```json
{
  "code": 200,
  "msg": "Driver registration submitted",
  "data": {
    "status": "pending",
    "driver_id": "review_123456",
    "estimated_review_time": "24小时内"
  },
  "timestamp": "2025-07-16T10:30:00Z"
}
```

### 逻辑说明
- 如果司机之前注册并通过了，拒绝新的注册申请
- 如果司机有等待审核的记录，新的注册申请会覆盖之前的记录
- 如果任何用户已经提交了相同驾照编号的注册申请且正在审核中，其他用户无法重复提交

## 3. 车辆注册

### 接口地址
`POST /api/drivers/vehicles/register`

### 请求头
```
Authorization: Bearer <driver_token>
```

### 请求参数
```json
{
  "plate_number": "浙A12345",
  "vehicle_type": "轿车",
  "brand": "大众",
  "model": "帕萨特",
  "color": "黑色",
  "year": 2020,
  "registration_image": "https://example.com/registration.jpg",
  "insurance_expiry": "2026-07-16"
}
```

### 响应示例
```json
{
  "code": 200,
  "msg": "Vehicle registration submitted",
  "data": {
    "vehicle_id": "vehicle_123456",
    "status": "pending",
    "verify_status": "verifying",
    "submit_time": "2025-07-16T10:30:00Z"
  },
  "timestamp": "2025-07-16T10:30:00Z"
}
```

### 权限说明
- 仅已认证的司机可以调用此接口

### 逻辑说明
- 提交车辆信息后，系统会创建一个待审核记录
- 车辆信息需要管理员审核通过后才能正式生效
- 如果车辆已经存在，会返回错误信息

## 2. 司机注册

### 接口地址
`POST /api/auth/driver/register`

### 请求头
```
Authorization: Bearer <token>
```

### 请求参数
```json
{
  "license_number": "330100199001011234",
  "license_image": "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQ...",
  "name": "李四",
  "phone": "139****8765"
}
```

### 响应示例
```json
{
  "code": 200,
  "msg": "Driver registration submitted",
  "data": {
    "status": "pending",
    "driver_id": "review_123456",
    "estimated_review_time": "24小时内"
  },
  "timestamp": "2025-07-16T10:30:00Z"
}
```

### 逻辑说明
- 如果司机之前注册并通过了，拒绝新的注册申请
- 如果司机有等待审核的记录，新的注册申请会覆盖之前的记录
- 如果任何用户已经提交了相同驾照编号的注册申请且正在审核中，其他用户无法重复提交

## 4. 管理员登录

### 接口地址
`POST /api/auth/admin/login`

### 请求参数
```json
{
  "phone": "13800138000",
  "password": "admin123456"
}
```

### 响应示例
```json
{
  "code": 200,
  "msg": "Admin login successful",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user_id": "admin_001",
    "role": "admin",
    "expires_in": 7200,
    "permissions": [
      "user_manage",
      "vehicle_audit",
      "order_manage"
    ]
  },
  "timestamp": "2025-07-16T10:30:00Z"
}
```

## 5. 刷新令牌

### 接口地址
`POST /api/auth/refresh`

### 请求头
```
Authorization: Bearer <token>
```

### 请求参数
```json
{
  "refresh_token": "refresh_token_string"
}
```

### 响应示例
```json
{
  "code": 200,
  "msg": "Token refreshed successfully",
  "data": {
    "token": "new_jwt_token",
    "expires_in": 7200
  },
  "timestamp": "2025-07-16T10:30:00Z"
}
```

## 6. 获取所有用户列表

### 接口地址
`GET /api/users`

### 请求头
```
Authorization: Bearer <admin_token>
```

### 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| page | int | 否 | 页码，默认为1 |
| page_size | int | 否 | 每页数量，默认为10 |
| nick_name | string | 否 | 用户昵称，支持模糊查询 |
| open_id | string | 否 | 用户OpenID，精确查询 |

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": {
    "users": [
      {
        "id": 1,
        "role_id": 1,
        "nick_name": "张三",
        "avatar_url": "https://example.com/avatar.jpg",
        "open_id": "openid_123"
      }
    ],
    "pagination": {
      "current_page": 1,
      "page_size": 10,
      "total_count": 1,
      "total_pages": 1
    }
  },
  "timestamp": "2025-07-16T10:30:00Z"
}
```

## 7. 获取所有司机列表

### 接口地址
`GET /api/users/drivers`

### 请求头
```
Authorization: Bearer <user_token>
```

### 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| page | int | 否 | 页码，默认为1 |
| page_size | int | 否 | 每页数量，默认为10 |
| name | string | 否 | 司机姓名，支持模糊查询 |
| phone | string | 否 | 电话号码，支持模糊查询 |
| license_number | string | 否 | 驾照编号，精确查询 |
| status | string | 否 | 司机状态(pending/approved/rejected/banned) |

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": {
    "drivers": [
      {
        "id": 1,
        "open_id": "openid_123",
        "license_number": "330100199001011234",
        "name": "李四",
        "phone": "139****8765",
        "license_image_url": "https://example.com/license.jpg",
        "status": "approved"
      }
    ],
    "pagination": {
      "current_page": 1,
      "page_size": 10,
      "total_count": 1,
      "total_pages": 1
    }
  },
  "timestamp": "2025-07-16T10:30:00Z"
}
```

### 权限说明
- 所有登录用户都可以查看司机列表

## 8. 司机信息审核列表

### 接口地址
`GET /api/admin/drivers/pending`

### 请求头
```
Authorization: Bearer <admin_token>
```

### 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| page | int | 否 | 页码，默认为1 |
| page_size | int | 否 | 每页数量，默认为10 |
| name | string | 否 | 司机姓名，支持模糊查询 |
| license_number | string | 否 | 驾照编号，精确查询 |
| status | string | 否 | 审核状态(pending/approved/rejected) |

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": {
    "drivers": [
      {
        "id": 1,
        "open_id": "openid_123",
        "license_number": "330100199001011234",
        "name": "李四",
        "phone": "139****8765",
        "license_image_url": "https://example.com/license.jpg",
        "status": "pending",
        "comment": "",
        "submit_time": "2025-07-16T10:30:00Z",
        "review_time": ""
      }
    ],
    "pagination": {
      "current_page": 1,
      "page_size": 10,
      "total_count": 1,
      "total_pages": 1
    }
  },
  "timestamp": "2025-07-16T10:30:00Z"
}
```

## 9. 获取司机审核详情

### 接口地址
`GET /api/users/drivers/pending/{id}`

### 请求头
```
Authorization: Bearer <user_token>
```

### 权限说明
- 用户可以查看本人的司机审核详情
- 管理员可以查看所有司机审核详情

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": {
    "id": 1,
    "open_id": "openid_123",
    "license_number": "330100199001011234",
    "name": "李四",
    "phone": "139****8765",
    "license_image_url": "https://example.com/license.jpg",
    "status": "pending",
    "comment": "",
    "submit_time": "2025-07-16T10:30:00Z"
  },
  "timestamp": "2025-07-16T10:30:00Z"
}
```

## 10. 批准司机审核

### 接口地址
`POST /api/admin/drivers/review/{id}`

### 请求头
```
Authorization: Bearer <admin_token>
```

### 请求参数
```json
{
  "action": "approved",
  "comment": "审核通过"
}
```

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": null,
  "timestamp": "2025-07-16T10:30:00Z"
}
```

## 11. 拒绝司机审核

### 接口地址
`POST /api/admin/drivers/review/{id}`

### 请求头
```
Authorization: Bearer <admin_token>
```

### 请求参数
```json
{
  "action": "rejected",
  "comment": "驾照信息不清晰，请重新上传"
}
```

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": null,
  "timestamp": "2025-07-16T10:30:00Z"
}
```

## 12. 车辆信息审核列表

### 接口地址
`GET /api/admin/vehicles/pending`

### 请求头
```
Authorization: Bearer <admin_token>
```

### 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| page | int | 否 | 页码，默认为1 |
| page_size | int | 否 | 每页数量，默认为10 |
| plate_number | string | 否 | 车牌号码，支持模糊查询 |
| brand | string | 否 | 车辆品牌，支持模糊查询 |
| model_name | string | 否 | 车辆型号，支持模糊查询 |
| status | string | 否 | 审核状态(pending/approved/rejected) |

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": {
    "vehicles": [
      {
        "id": 1,
        "driver_id": "driver_123",
        "plate_number": "浙A12345",
        "vehicle_type": "轿车",
        "brand": "大众",
        "model_name": "帕萨特",
        "color": "黑色",
        "year": 2020,
        "registration_image": "https://example.com/registration.jpg",
        "insurance_expiry": "2026-07-16T00:00:00Z",
        "status": "pending",
        "comment": "",
        "submit_time": "2025-07-16T10:30:00Z"
      }
    ],
    "pagination": {
      "current_page": 1,
      "page_size": 10,
      "total_count": 1,
      "total_pages": 1
    }
  },
  "timestamp": "2025-07-16T10:30:00Z"
}
```

## 13. 批准车辆审核

### 接口地址
`POST /api/admin/vehicles/review/{id}`

### 请求头
```
Authorization: Bearer <admin_token>
```

### 请求参数
```json
{
  "action": "approved",
  "comment": "审核通过"
}
```

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": null,
  "timestamp": "2025-07-16T10:30:00Z"
}
```

## 14. 拒绝车辆审核

### 接口地址
`POST /api/admin/vehicles/review/{id}`

### 请求头
```
Authorization: Bearer <admin_token>
```

### 请求参数
```json
{
  "action": "rejected",
  "comment": "行驶证信息不清晰，请重新上传"
}
```

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": null,
  "timestamp": "2025-07-16T10:30:00Z"
}
```

## 15. 获取车辆审核详情

### 接口地址
`GET /api/vehicles/pending/{id}`

### 请求头
```
Authorization: Bearer <user_token>
```

### 权限说明
- 用户可以查看本人的车辆审核详情
- 管理员可以查看所有车辆审核详情

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": {
    "id": 1,
    "driver_id": "driver_123",
    "plate_number": "浙A12345",
    "vehicle_type": "轿车",
    "brand": "大众",
    "model_name": "帕萨特",
    "color": "黑色",
    "year": 2020,
    "registration_image": "https://example.com/registration.jpg",
    "insurance_expiry": "2026-07-16T00:00:00Z",
    "status": "pending",
    "comment": "",
    "submit_time": "2025-07-16T10:30:00Z"
  },
  "timestamp": "2025-07-16T10:30:00Z"
}
```

## 16. 获取当前用户个人信息

### 接口地址
`GET /api/users/profile`

### 请求头
```
Authorization: Bearer <user_token>
```

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": {
    "id": 1,
    "role_id": 1,
    "nick_name": "张三",
    "avatar_url": "https://example.com/avatar.jpg",
    "open_id": "openid_123"
  },
  "timestamp": "2025-07-16T10:30:00Z"
}
```

## 17. 获取司机信息

### 接口地址
`GET /api/users/drivers/info/:id`

### 请求头
```
Authorization: Bearer <user_token>
```

### 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | int | 否 | 司机ID，如果不传则返回当前用户作为司机的信息 |

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": {
    "id": 1,
    "open_id": "openid_123",
    "license_number": "330100199001011234",
    "name": "李四",
    "phone": "139****8765",
    "license_image_url": "https://example.com/license.jpg",
    "status": "approved"
  },
  "timestamp": "2025-07-16T10:30:00Z"
}
```

### 功能说明
- 如果没有传id参数，则返回当前用户作为司机的信息
- 如果传了id参数，则返回指定id的司机信息
- 如果当前用户不是司机，则返回空

### 权限说明
- 所有登录用户都可以查看司机信息

## 18. 封禁司机

### 接口地址
`PUT /api/users/drivers/{id}/ban`

### 请求头
```
Authorization: Bearer <admin_token>
```

### 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | int | 是 | 司机ID |

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": null,
  "timestamp": "2025-07-16T10:30:00Z"
}
```

### 权限说明
- 仅管理员可以调用此接口

## 18. 解封司机

### 接口地址
`PUT /api/users/drivers/{id}/unban`

### 请求头
```
Authorization: Bearer <admin_token>
```

### 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | int | 是 | 司机ID |

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": null,
  "timestamp": "2025-07-16T10:30:00Z"
}
```

### 权限说明
- 仅管理员可以调用此接口

## 19. 获取车辆列表

### 接口地址
`GET /api/vehicles`

### 请求头
```
Authorization: Bearer <user_token>
```

### 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| page | int | 否 | 页码，默认为1 |
| page_size | int | 否 | 每页数量，默认为10 |
| plate_number | string | 否 | 车牌号码，支持模糊查询 |
| brand | string | 否 | 车辆品牌，支持模糊查询 |
| model_name | string | 否 | 车辆型号，支持模糊查询 |
| status | string | 否 | 车辆状态(pending/approved/rejected) |

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": {
    "vehicles": [
      {
        "id": "vehicle_1",
        "driver_id": "driver_123",
        "driver_name": "张三",
        "driver_phone": "13800138000",
        "plate_number": "浙A12345",
        "vehicle_type": "轿车",
        "brand": "大众",
        "model": "帕萨特",
        "color": "黑色",
        "year": 2020,
        "registration_image": "https://example.com/registration.jpg",
        "insurance_expiry": "2026-07-16T00:00:00Z",
        "status": "approved",
        "comment": "审核通过",
        "submit_time": "2025-07-16T10:30:00Z",
        "review_time": "2025-07-16T11:30:00Z",
        "reviewer": "admin_001"
      }
    ],
    "pagination": {
      "current_page": 1,
      "page_size": 10,
      "total_count": 1,
      "total_pages": 1
    }
  },
  "timestamp": "2025-07-16T10:30:00Z"
}
```

### 权限说明
- 所有登录用户都可以查看车辆列表

## 20. 获取车辆详情

### 接口地址
`GET /api/vehicles/{vehicle_id}`

### 请求头
```
Authorization: Bearer <user_token>
```

### 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| vehicle_id | string | 是 | 车辆ID |

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": {
    "id": "vehicle_1",
    "driver_id": "driver_123",
    "driver_name": "张三",
    "driver_phone": "13800138000",
    "plate_number": "浙A12345",
    "vehicle_type": "轿车",
    "brand": "大众",
    "model": "帕萨特",
    "color": "黑色",
    "year": 2020,
    "registration_image": "https://example.com/registration.jpg",
    "insurance_expiry": "2026-07-16T00:00:00Z",
    "status": "approved",
    "comment": "审核通过",
    "submit_time": "2025-07-16T10:30:00Z",
    "review_time": "2025-07-16T11:30:00Z",
    "reviewer": "admin_001"
  },
  "timestamp": "2025-07-16T10:30:00Z"
}
```

### 权限说明
- 所有登录用户都可以查看车辆详情

## 21. 删除车辆

### 接口地址
`DELETE /api/vehicles/{vehicle_id}` 或 `DELETE /api/admin/vehicles/{vehicle_id}`

### 请求头
```
Authorization: Bearer <user_token> 或 <admin_token>
```

### 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| vehicle_id | string | 是 | 车辆ID |

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": null,
  "timestamp": "2025-07-16T10:30:00Z"
}
```

### 权限说明
- 用户可以删除自己的车辆
- 管理员可以删除任何车辆
- 用户尝试删除其他用户的车辆将返回权限错误

## 22. 更新当前用户个人信息

### 接口地址
`PUT /api/users/profile`

### 请求头
```
Authorization: Bearer <user_token>
```

### 请求参数
参数名 | 类型 | 必填 | 说明
|--------|------|------|------|
nick_name | string | 否 | 用户昵称
avatar_url | string | 否 | 用户头像URL

### 请求示例
```json
{
  "nick_name": "新昵称",
  "avatar_url": "https://example.com/new_avatar.jpg"
}
```

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": null,
  "timestamp": "2025-07-16T10:30:00Z"
}
```

### 权限说明
- 所有登录用户都可以调用此接口
- 用户只能更新自己的信息

## 23. 重置当前用户个人信息

### 接口地址
`PUT /api/users/profile/reset`

### 请求头
```
Authorization: Bearer <user_token>
```

### 请求参数
无

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": null,
  "timestamp": "2025-07-16T10:30:00Z"
}
```

### 权限说明
- 所有登录用户都可以调用此接口
- 用户只能重置自己的信息

## 24. 管理员重置用户个人信息

### 接口地址
`PUT /api/users/profile/reset/{id}`

### 请求头
```
Authorization: Bearer <admin_token>
```

### 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | int | 是 | 用户ID |

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": null,
  "timestamp": "2025-07-16T10:30:00Z"
}
```

### 权限说明
- 仅管理员可以调用此接口
- 管理员可以重置任意用户的信息

## 25. 获取司机名下车辆列表

### 接口地址
`GET /api/users/drivers/{id}/vehicles`

### 请求头
```
Authorization: Bearer <user_token>
```

### 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | int | 是 | 司机ID |

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": {
    "vehicles": [
      {
        "id": "vehicle_1",
        "driver_id": "driver_123",
        "driver_name": "张三",
        "driver_phone": "13800138000",
        "plate_number": "浙A12345",
        "vehicle_type": "轿车",
        "brand": "大众",
        "model": "帕萨特",
        "color": "黑色",
        "year": 2020,
        "registration_image": "https://example.com/registration.jpg",
        "insurance_expiry": "2026-07-16T00:00:00Z",
        "status": "approved",
        "comment": "审核通过",
        "submit_time": "2025-07-16T10:30:00Z",
        "review_time": "2025-07-16T11:30:00Z",
        "reviewer": "admin_001"
      }
    ]
  },
  "timestamp": "2025-07-16T10:30:00Z"
}
```

### 权限说明
- 所有登录用户都可以查看司机名下的车辆信息

## 26. 获取司机自己的所有司机审核信息列表

### 接口地址
`GET /api/users/drivers/self/pending`

### 请求头
```
Authorization: Bearer <driver_token>
```

### 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| page | int | 否 | 页码，默认为1 |
| page_size | int | 否 | 每页数量，默认为10 |
| name | string | 否 | 司机姓名，支持模糊查询 |
| license_number | string | 否 | 驾照编号，精确查询 |
| status | string | 否 | 审核状态(pending/approved/rejected) |

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": {
    "drivers": [
      {
        "id": 1,
        "open_id": "openid_123",
        "license_number": "330100199001011234",
        "name": "李四",
        "phone": "139****8765",
        "license_image_url": "https://example.com/license.jpg",
        "status": "pending",
        "comment": "",
        "submit_time": "2025-07-16T10:30:00Z",
        "review_time": ""
      }
    ],
    "pagination": {
      "current_page": 1,
      "page_size": 10,
      "total_count": 1,
      "total_pages": 1
    }
  },
  "timestamp": "2025-07-16T10:30:00Z"
}
```

### 权限说明
- 司机可以查看自己的所有司机审核信息列表

## 27. 获取司机自己的所有车辆审核信息列表

### 接口地址
`GET /api/vehicles/self/pending`

### 请求头
```
Authorization: Bearer <driver_token>
```

### 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| page | int | 否 | 页码，默认为1 |
| page_size | int | 否 | 每页数量，默认为10 |
| plate_number | string | 否 | 车牌号码，支持模糊查询 |
| brand | string | 否 | 车辆品牌，支持模糊查询 |
| model_name | string | 否 | 车辆型号，支持模糊查询 |
| status | string | 否 | 审核状态(pending/approved/rejected) |

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": {
    "vehicles": [
      {
        "id": 1,
        "driver_id": "driver_123",
        "plate_number": "浙A12345",
        "vehicle_type": "轿车",
        "brand": "大众",
        "model_name": "帕萨特",
        "color": "黑色",
        "year": 2020,
        "registration_image": "https://example.com/registration.jpg",
        "insurance_expiry": "2026-07-16T00:00:00Z",
        "status": "pending",
        "comment": "",
        "submit_time": "2025-07-16T10:30:00Z"
      }
    ],
    "pagination": {
      "current_page": 1,
      "page_size": 10,
      "total_count": 1,
      "total_pages": 1
    }
  },
  "timestamp": "2025-07-16T10:30:00Z"
}
```

### 权限说明
- 司机可以查看自己的所有车辆审核信息列表

## 28. 上传图片

### 接口地址
`POST /api/image/upload`

### 请求头
```
Authorization: Bearer <user_token>
Content-Type: multipart/form-data
```

### 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| image | file | 是 | 图片文件 |

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": {
    "image_url": "https://example.com/uploaded_image.jpg"
  },
  "timestamp": "2025-07-16T10:30:00Z"
}
```

### 权限说明
- 所有登录用户都可以调用此接口
- 用户需要提供有效的认证令牌

### 逻辑说明
- 接口接收图片文件并上传到对象存储服务
- 上传成功后返回图片的可访问URL
- 图片文件大小和格式限制由后端配置决定

## 29. 创建立即出发订单

### 接口地址
`POST /api/orders/immediate`

### 请求头
```
Authorization: Bearer <user_token>
```

### 请求参数
```json
{
  "points": [
    {
      "latitude": 36.680143,
      "longitude": 117.06532
    }
  ],
  "distance": 1240,
  "duration": 5,
  "tolls": 8,
  "tags": [],
  "steps": [
    {
      "instruction": "沿内部道路行驶6米,左转",
      "polyline_idx": [0, 3],
      "road_name": "内部道路",
      "dir_desc": "",
      "distance": 6,
      "act_desc": "左转",
      "accessorial_desc": ""
    }
  ],
  "startLocation": {
    "latitude": 36.68013,
    "longitude": 117.06533,
    "name": "当前位置"
  },
  "endLocation": {
    "name": "山东大学(中心校区)",
    "latitude": 36.675681,
    "longitude": 117.059985,
    "address": "山东省济南市历城区山大南路27号",
    "province": "山东省",
    "city": "济南市",
    "district": "历城区"
  }
}
```

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": {
    "order_id": 1
  },
  "timestamp": "2025-07-16T10:30:00Z"
}
```

### 权限说明
- 仅已认证的用户可以调用此接口

### 逻辑说明
- 创建订单后，订单初始状态为"等待司机接单"
- 订单会被保存到数据库中
- 订单ID会被添加到Redis中对应状态的集合中
- 结束待付款和已完结状态的订单不会在Redis中维护

## 30. 获取订单详情

### 接口地址
`GET /api/orders/{id}`

### 请求头
```
Authorization: Bearer <user_token>
```

### 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | int | 是 | 订单ID |

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": {
    "id": 1,
    "user_open_id": "openid_user1",
    "driver_open_id": "",
    "vehicle_id": 0,
    "start_location": {
      "latitude": 36.68013,
      "longitude": 117.06533,
      "name": "当前位置"
    },
    "end_location": {
      "name": "山东大学(中心校区)",
      "latitude": 36.675681,
      "longitude": 117.059985,
      "address": "山东省济南市历城区山大南路27号",
      "province": "山东省",
      "city": "济南市",
      "district": "历城区"
    },
    "route_points": [
      {
        "latitude": 36.680143,
        "longitude": 117.06532
      }
    ],
    "start_time": "2025-07-16 10:30:00",
    "end_time": null,
    "distance": 1.24,
    "duration": 5,
    "fare": 8,
    "tolls": 8,
    "status": "waiting_for_driver",
    "payment_time": null,
    "comment": "",
    "cancel_reason": "",
    "rating": 0,
    "reserve_time": "2025-07-16 11:00:00"
  },
  "timestamp": "2025-07-16T10:30:00Z"
}
```

### 权限说明
- 用户只能查看自己的订单
- 管理员可以查看所有订单

## 31. 获取用户未完成订单

### 接口地址
`GET /api/orders/unfinished`

### 请求头
```
Authorization: Bearer <user_token>
```

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": {
    "id": 1,
    "user_open_id": "openid_user1",
    "driver_open_id": "",
    "vehicle_id": 0,
    "start_location": {
      "latitude": 36.68013,
      "longitude": 117.06533,
      "name": "当前位置"
    },
    "end_location": {
      "name": "山东大学(中心校区)",
      "latitude": 36.675681,
      "longitude": 117.059985,
      "address": "山东省济南市历城区山大南路27号",
      "province": "山东省",
      "city": "济南市",
      "district": "历城区"
    },
    "route_points": [
      {
        "latitude": 36.680143,
        "longitude": 117.06532
      }
    ],
    "start_time": "2025-07-16 10:30:00",
    "end_time": null,
    "distance": 1.24,
    "duration": 5,
    "fare": 8,
    "tolls": 8,
    "status": "waiting_for_driver",
    "payment_time": null,
    "comment": "",
    "cancel_reason": "",
    "rating": 0,
    "reserve_time": "2025-07-16 11:00:00"
  },
  "timestamp": "2025-07-16T10:30:00Z"
}
```

### 权限说明
- 仅已认证的用户可以调用此接口
- 用户只能查询自己的未完成订单

### 逻辑说明
- 未完成订单指的是状态不是"completed"也不是"cancelled"的订单
- 如果用户没有未完成订单，返回空数据
- 每个用户只能有一个未完成订单

## 32. 获取司机未完成订单

### 接口地址
`GET /api/orders/driver/unfinished`

### 请求头
```
Authorization: Bearer <driver_token>
```

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": {
    "id": 1,
    "user_open_id": "openid_user1",
    "driver_open_id": "openid_driver1",
    "vehicle_id": 1,
    "start_location": {
      "latitude": 36.68013,
      "longitude": 117.06533,
      "name": "当前位置"
    },
    "end_location": {
      "name": "山东大学(中心校区)",
      "latitude": 36.675681,
      "longitude": 117.059985,
      "address": "山东省济南市历城区山大南路27号",
      "province": "山东省",
      "city": "济南市",
      "district": "历城区"
    },
    "route_points": [
      {
        "latitude": 36.680143,
        "longitude": 117.06532
      }
    ],
    "start_time": "2025-07-16 10:30:00",
    "end_time": null,
    "distance": 1.24,
    "duration": 5,
    "fare": 8,
    "tolls": 8,
    "status": "waiting_for_driver",
    "payment_time": null,
    "comment": "",
    "cancel_reason": "",
    "rating": 0,
    "reserve_time": "2025-07-16 11:00:00"
  },
  "timestamp": "2025-07-16T10:30:00Z"
}
```

### 权限说明
- 仅已认证的司机可以调用此接口
- 司机只能查询自己的未完成订单

### 逻辑说明
- 未完成订单指的是状态不是"completed"也不是"cancelled"的订单
- 如果司机没有未完成订单，返回空数据
- 每个司机只能有一个未完成订单

## 33. 获取用户所有订单列表

### 接口地址
`GET /api/orders`

### 请求头
```
Authorization: Bearer <user_token>
```

### 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| page | int | 否 | 页码，默认为1 |
| page_size | int | 否 | 每页数量，默认为10 |
| status | string | 否 | 订单状态 |
| start_time | string | 否 | 开始时间，格式为YYYY-MM-DD |
| end_time | string | 否 | 结束时间，格式为YYYY-MM-DD |

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": {
    "orders": [
      {
        "id": 1,
        "user_open_id": "openid_user1",
        "driver_open_id": "openid_driver1",
        "vehicle_id": 1,
        "start_location": {
          "latitude": 36.68013,
          "longitude": 117.06533,
          "name": "当前位置"
        },
        "end_location": {
          "name": "山东大学(中心校区)",
          "latitude": 36.675681,
          "longitude": 117.059985,
          "address": "山东省济南市历城区山大南路27号",
          "province": "山东省",
          "city": "济南市",
          "district": "历城区"
        },
        "route_points": [
          {
            "latitude": 36.680143,
            "longitude": 117.06532
          }
        ],
        "start_time": "2025-07-16 10:30:00",
        "end_time": "2025-07-16 10:35:00",
        "distance": 1.24,
        "duration": 5,
        "fare": 8,
        "tolls": 8,
        "status": "completed",
        "payment_time": "2025-07-16 10:35:00",
        "comment": "行程愉快",
        "cancel_reason": "",
        "rating": 5,
        "reserve_time": "2025-07-16 11:00:00"
      }
    ],
    "pagination": {
      "current_page": 1,
      "page_size": 10,
      "total_count": 1,
      "total_pages": 1
    }
  },
  "timestamp": "2025-07-16T10:30:00Z"
}
```

### 权限说明
- 仅已认证的用户可以调用此接口
- 用户只能查询自己的订单列表

### 逻辑说明
- 支持分页查询
- 支持按订单状态筛选
- 支持按时间范围筛选
- 返回结果按订单ID降序排列

## 34. 获取司机所有订单列表

### 接口地址
`GET /api/orders/driver`

### 请求头
```
Authorization: Bearer <driver_token>
```

### 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| page | int | 否 | 页码，默认为1 |
| page_size | int | 否 | 每页数量，默认为10 |
| status | string | 否 | 订单状态 |
| start_time | string | 否 | 开始时间，格式为YYYY-MM-DD |
| end_time | string | 否 | 结束时间，格式为YYYY-MM-DD |

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": {
    "orders": [
      {
        "id": 1,
        "user_open_id": "openid_user1",
        "driver_open_id": "openid_driver1",
        "vehicle_id": 1,
        "start_location": {
          "latitude": 36.68013,
          "longitude": 117.06533,
          "name": "当前位置"
        },
        "end_location": {
          "name": "山东大学(中心校区)",
          "latitude": 36.675681,
          "longitude": 117.059985,
          "address": "山东省济南市历城区山大南路27号",
          "province": "山东省",
          "city": "济南市",
          "district": "历城区"
        },
        "route_points": [
          {
            "latitude": 36.680143,
            "longitude": 117.06532
          }
        ],
        "start_time": "2025-07-16 10:30:00",
        "end_time": "2025-07-16 10:35:00",
        "distance": 1.24,
        "duration": 5,
        "fare": 8,
        "tolls": 8,
        "status": "completed",
        "payment_time": "2025-07-16 10:35:00",
        "comment": "行程愉快",
        "cancel_reason": "",
        "rating": 5,
        "reserve_time": "2025-07-16 11:00:00"
      }
    ],
    "pagination": {
      "current_page": 1,
      "page_size": 10,
      "total_count": 1,
      "total_pages": 1
    }
  },
  "timestamp": "2025-07-16T10:30:00Z"
}
```

### 权限说明
- 仅已认证的司机可以调用此接口
- 司机只能查询自己的订单列表

### 逻辑说明
- 支持分页查询
- 支持按订单状态筛选
- 支持按时间范围筛选
- 返回结果按订单ID降序排列

## 35. 获取所有订单列表（管理员）

### 接口地址
`GET /api/orders/admin`

### 请求头
```
Authorization: Bearer <admin_token>
```

### 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| page | int | 否 | 页码，默认为1 |
| page_size | int | 否 | 每页数量，默认为10 |
| status | string | 否 | 订单状态 |
| user_open_id | string | 否 | 用户OpenID |
| driver_open_id | string | 否 | 司机OpenID |
| start_time | string | 否 | 开始时间，格式为YYYY-MM-DD |
| end_time | string | 否 | 结束时间，格式为YYYY-MM-DD |

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": {
    "orders": [
      {
        "id": 1,
        "user_open_id": "openid_user1",
        "driver_open_id": "openid_driver1",
        "vehicle_id": 1,
        "start_location": {
          "latitude": 36.68013,
          "longitude": 117.06533,
          "name": "当前位置"
        },
        "end_location": {
          "name": "山东大学(中心校区)",
          "latitude": 36.675681,
          "longitude": 117.059985,
          "address": "山东省济南市历城区山大南路27号",
          "province": "山东省",
          "city": "济南市",
          "district": "历城区"
        },
        "route_points": [
          {
            "latitude": 36.680143,
            "longitude": 117.06532
          }
        ],
        "start_time": "2025-07-16 10:30:00",
        "end_time": "2025-07-16 10:35:00",
        "distance": 1.24,
        "duration": 5,
        "fare": 8,
        "tolls": 8,
        "status": "completed",
        "payment_time": "2025-07-16 10:35:00",
        "comment": "行程愉快",
        "cancel_reason": "",
        "rating": 5,
        "reserve_time": "2025-07-16 11:00:00"
      }
    ],
    "pagination": {
      "current_page": 1,
      "page_size": 10,
      "total_count": 1,
      "total_pages": 1
    }
  },
  "timestamp": "2025-07-16T10:30:00Z"
}
```

### 权限说明
- 仅管理员可以调用此接口
- 管理员可以查询所有订单

### 逻辑说明
- 支持分页查询
- 支持按订单状态筛选
- 支持按用户OpenID筛选
- 支持按司机OpenID筛选
- 支持按时间范围筛选
- 返回结果按订单ID降序排列

## 36. 司机上传位置信息

### 接口地址
`POST /api/rides/location`

### 请求头
```
Authorization: Bearer <driver_token>
```

### 请求参数
```json
{
  "latitude": 36.680143,
  "longitude": 117.06532
}
```

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": null,
  "timestamp": "2025-07-16T10:30:00Z"
}
```

### 权限说明
- 仅已认证的司机或管理员可以调用此接口

### 逻辑说明
- 司机上传当前位置的经纬度信息
- 位置信息会被存储到Redis中，包含司机的openid、坐标和更新时间
- 位置信息在Redis中设置1小时的过期时间

## 37. 获取司机位置信息

### 接口地址
`GET /api/rides/location/{driver_id}`

### 请求头
```
Authorization: Bearer <user_token>
```

### 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| driver_id | string | 是 | 司机ID |

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": {
    "open_id": "openid_driver1",
    "latitude": 36.680143,
    "longitude": 117.06532,
    "update_time": 1626456600
  },
  "timestamp": "2025-07-16T10:30:00Z"
}
```

### 权限说明
- 所有已认证的用户都可以调用此接口

### 逻辑说明
- 用户可以通过司机ID查询司机的当前位置信息
- 位置信息从Redis中获取，包含司机的openid、坐标和更新时间
- 如果Redis中没有该司机的位置信息，返回404错误

## 38. 司机请求订单

### 接口地址
`GET /api/rides/order/request`

### 请求头
```
Authorization: Bearer <driver_token>
```

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": {
    "id": 1,
    "user_open_id": "openid_user1",
    "driver_open_id": "",
    "vehicle_id": 0,
    "start_location": {
      "latitude": 36.68013,
      "longitude": 117.06533,
      "name": "当前位置"
    },
    "end_location": {
      "name": "山东大学(中心校区)",
      "latitude": 36.675681,
      "longitude": 117.059985,
      "address": "山东省济南市历城区山大南路27号",
      "province": "山东省",
      "city": "济南市",
      "district": "历城区"
    },
    "route_points": [
      {
        "latitude": 36.680143,
        "longitude": 117.06532
      }
    ],
    "start_time": "2025-07-16 10:30:00",
    "end_time": null,
    "distance": 1.24,
    "duration": 5,
    "fare": 8,
    "tolls": 8,
    "status": "waiting_for_driver",
    "payment_time": null,
    "comment": "",
    "cancel_reason": "",
    "rating": 0,
    "reserve_time": "2025-07-16 11:00:00"
  },
  "timestamp": "2025-07-16T10:30:00Z"
}
```

### 权限说明
- 仅已认证的司机可以调用此接口

### 逻辑说明
- 司机请求订单时，系统会根据司机当前位置匹配最近的等待接单订单
- 司机必须没有未完成的订单才能请求新订单
- 系统会从Redis中查找等待司机接单的订单，并根据距离匹配最近的一个

## 39. 司机接单

### 接口地址
`POST /api/rides/order/take`

### 请求头
```
Authorization: Bearer <driver_token>
```

### 请求参数
```json
{
  "order_id": 1,
  "vehicle_id": 1
}
```

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": null,
  "timestamp": "2025-07-16T10:30:00Z"
}
```

### 权限说明
- 仅已认证的司机可以调用此接口

### 逻辑说明
- 司机接单时，需要提供订单ID和车辆ID
- 司机必须没有未完成的订单才能接单
- 系统会检查订单状态是否为等待司机接单
- 系统会验证车辆是否存在、是否属于该司机以及是否已通过审核
- 接单成功后，订单状态会更新为等待司机到达起点，并记录车辆ID
- 系统会同时更新数据库和Redis中的订单状态

## 40. 创建预约订单

### 接口地址
`POST /api/orders/reserve`

### 请求头
```
Authorization: Bearer <user_token>
```

### 请求参数
```json
{
  "points": [
    {
      "latitude": 36.680143,
      "longitude": 117.06532
    }
  ],
  "distance": 1240,
  "duration": 5,
  "tolls": 8,
  "tags": [],
  "steps": [
    {
      "instruction": "沿内部道路行驶6米,左转",
      "polyline_idx": [0, 3],
      "road_name": "内部道路",
      "dir_desc": "",
      "distance": 6,
      "act_desc": "左转",
      "accessorial_desc": ""
    }
  ],
  "startLocation": {
    "latitude": 36.68013,
    "longitude": 117.06533,
    "name": "当前位置"
  },
  "endLocation": {
    "name": "山东大学(中心校区)",
    "latitude": 36.675681,
    "longitude": 117.059985,
    "address": "山东省济南市历城区山大南路27号",
    "province": "山东省",
    "city": "济南市",
    "district": "历城区"
  },
  "reserveTime": "2025-07-16 11:00:00"
}
```

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": {
    "order_id": 1
  },
  "timestamp": "2025-07-16T10:30:00Z"
}
```

### 权限说明
- 仅已认证的用户可以调用此接口

### 逻辑说明
- 创建预约订单后，订单初始状态为"预约中"
- 预约时间必须晚于当前时间
- 订单会被保存到数据库中
- 订单ID会被添加到Redis中对应状态的集合中
- 结束待付款和已完结状态的订单不会在Redis中维护

## 41. 处理预约订单

### 接口地址
`POST /api/rides/orders/process-reserve`

### 请求头
```
Authorization: Bearer <admin_token>
```

### 请求参数
无

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": {
    "processed_orders": [1, 2, 3]
  },
  "timestamp": "2025-07-16T10:30:00Z"
}
```

### 权限说明
- 仅管理员可以调用此接口

### 逻辑说明
- 系统会检查Redis中所有预约中的订单
- 找到离预约时间只剩10分钟的预约订单
- 如果用户没有进行中的订单，则将该预约订单状态从"预约中"改为"等待司机接单"
- 处理完成后返回已处理的订单ID列表
