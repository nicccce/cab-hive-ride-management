# 认证接口文档

## 1. 微信用户登录

### 接口地址
`POST /api/auth/wechat/login`

### 请求参数
```json
{
  "code": "wx_temp_code_123",
  "encryptedData": "encrypted_user_data",
  "iv": "initialization_vector"
}
```

### 响应示例
```json
{
  "code": 200,
  "msg": "Login successful",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user_id": "user_123456",
    "role": "customer",
    "expires_in": 7200,
    "user_info": {
      "nickname": "张三",
      "avatar": "https://wx.qlogo.cn/...",
      "phone": "138****5678"
    }
  },
  "timestamp": "2025-07-16T10:30:00Z"
}
```

## 2. 司机注册

### 接口地址
`POST /api/auth/driver/register`

### 请求头
```
Authorization: Bearer <token>
```

### 请求参数
```json
{
  "license_number": "330100199001011234",
  "license_image": "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQ...",
  "name": "李四",
  "phone": "139****8765"
}
```

### 响应示例
```json
{
  "code": 200,
  "msg": "Driver registration submitted",
  "data": {
    "status": "pending",
    "driver_id": "review_123456",
    "estimated_review_time": "24小时内"
  },
  "timestamp": "2025-07-16T10:30:00Z"
}
```

## 3. 管理员登录

### 接口地址
`POST /api/auth/admin/login`

### 请求参数
```json
{
  "phone": "13800138000",
  "password": "admin123456"
}
```

### 响应示例
```json
{
  "code": 200,
  "msg": "Admin login successful",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user_id": "admin_001",
    "role": "admin",
    "expires_in": 7200,
    "permissions": [
      "user_manage",
      "vehicle_audit",
      "order_manage"
    ]
  },
  "timestamp": "2025-07-16T10:30:00Z"
}
```

## 4. 刷新令牌

### 接口地址
`POST /api/auth/refresh`

### 请求头
```
Authorization: Bearer <token>
```

### 请求参数
```json
{
  "refresh_token": "refresh_token_string"
}
```

### 响应示例
```json
{
  "code": 200,
  "msg": "Token refreshed successfully",
  "data": {
    "token": "new_jwt_token",
    "expires_in": 7200
  },
  "timestamp": "2025-07-16T10:30:00Z"
}
```

## 5. 获取所有用户列表

### 接口地址
`GET /api/users`

### 请求头
```
Authorization: Bearer <admin_token>
```

### 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| page | int | 否 | 页码，默认为1 |
| page_size | int | 否 | 每页数量，默认为10 |
| nick_name | string | 否 | 用户昵称，支持模糊查询 |
| open_id | string | 否 | 用户OpenID，精确查询 |

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": {
    "users": [
      {
        "id": 1,
        "role_id": 1,
        "nick_name": "张三",
        "avatar_url": "https://example.com/avatar.jpg",
        "open_id": "openid_123"
      }
    ],
    "pagination": {
      "current_page": 1,
      "page_size": 10,
      "total_count": 1,
      "total_pages": 1
    }
  },
  "timestamp": "2025-07-16T10:30:00Z"
}
```

## 6. 获取所有司机列表

### 接口地址
`GET /api/users/drivers`

### 请求头
```
Authorization: Bearer <admin_token>
```

### 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| page | int | 否 | 页码，默认为1 |
| page_size | int | 否 | 每页数量，默认为10 |
| name | string | 否 | 司机姓名，支持模糊查询 |
| phone | string | 否 | 电话号码，支持模糊查询 |
| license_number | string | 否 | 驾照编号，精确查询 |
| status | string | 否 | 司机状态(pending/approved/rejected/banned) |

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": {
    "drivers": [
      {
        "id": 1,
        "open_id": "openid_123",
        "license_number": "330100199001011234",
        "name": "李四",
        "phone": "139****8765",
        "license_image_url": "https://example.com/license.jpg",
        "status": "approved"
      }
    ],
    "pagination": {
      "current_page": 1,
      "page_size": 10,
      "total_count": 1,
      "total_pages": 1
    }
  },
  "timestamp": "2025-07-16T10:30:00Z"
}
```

## 7. 司机信息审核列表

### 接口地址
`GET /api/admin/drivers/pending`

### 请求头
```
Authorization: Bearer <admin_token>
```

### 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| page | int | 否 | 页码，默认为1 |
| page_size | int | 否 | 每页数量，默认为10 |
| name | string | 否 | 司机姓名，支持模糊查询 |
| license_number | string | 否 | 驾照编号，精确查询 |
| status | string | 否 | 审核状态(pending/approved/rejected) |

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": {
    "drivers": [
      {
        "id": 1,
        "open_id": "openid_123",
        "license_number": "330100199001011234",
        "name": "李四",
        "phone": "139****8765",
        "license_image_url": "https://example.com/license.jpg",
        "status": "pending",
        "comment": "",
        "submit_time": "2025-07-16T10:30:00Z",
        "review_time": ""
      }
    ],
    "pagination": {
      "current_page": 1,
      "page_size": 10,
      "total_count": 1,
      "total_pages": 1
    }
  },
  "timestamp": "2025-07-16T10:30:00Z"
}
```

## 8. 获取司机审核详情

### 接口地址
`GET /api/users/drivers/pending/{id}`

### 请求头
```
Authorization: Bearer <user_token>
```

### 权限说明
- 用户可以查看本人的司机审核详情
- 管理员可以查看所有司机审核详情

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": {
    "id": 1,
    "open_id": "openid_123",
    "license_number": "330100199001011234",
    "name": "李四",
    "phone": "139****8765",
    "license_image_url": "https://example.com/license.jpg",
    "status": "pending",
    "comment": "",
    "submit_time": "2025-07-16T10:30:00Z"
  },
  "timestamp": "2025-07-16T10:30:00Z"
}
```

## 9. 批准司机审核

### 接口地址
`POST /api/admin/drivers/review/{id}`

### 请求头
```
Authorization: Bearer <admin_token>
```

### 请求参数
```json
{
  "action": "approved",
  "comment": "审核通过"
}
```

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": null,
  "timestamp": "2025-07-16T10:30:00Z"
}
```

## 10. 拒绝司机审核

### 接口地址
`POST /api/admin/drivers/review/{id}`

### 请求头
```
Authorization: Bearer <admin_token>
```

### 请求参数
```json
{
  "action": "rejected",
  "comment": "驾照信息不清晰，请重新上传"
}
```

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": null,
  "timestamp": "2025-07-16T10:30:00Z"
}
```

## 11. 车辆信息审核列表

### 接口地址
`GET /api/admin/vehicles/pending`

### 请求头
```
Authorization: Bearer <admin_token>
```

### 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| page | int | 否 | 页码，默认为1 |
| page_size | int | 否 | 每页数量，默认为10 |
| plate_number | string | 否 | 车牌号码，支持模糊查询 |
| brand | string | 否 | 车辆品牌，支持模糊查询 |
| model_name | string | 否 | 车辆型号，支持模糊查询 |
| status | string | 否 | 审核状态(pending/approved/rejected) |

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": {
    "vehicles": [
      {
        "id": 1,
        "driver_id": "driver_123",
        "plate_number": "浙A12345",
        "vehicle_type": "轿车",
        "brand": "大众",
        "model_name": "帕萨特",
        "color": "黑色",
        "year": 2020,
        "registration_image": "https://example.com/registration.jpg",
        "insurance_expiry": "2026-07-16T00:00:00Z",
        "status": "pending",
        "comment": "",
        "submit_time": "2025-07-16T10:30:00Z"
      }
    ],
    "pagination": {
      "current_page": 1,
      "page_size": 10,
      "total_count": 1,
      "total_pages": 1
    }
  },
  "timestamp": "2025-07-16T10:30:00Z"
}
```

## 12. 批准车辆审核

### 接口地址
`POST /api/admin/vehicles/review/{id}`

### 请求头
```
Authorization: Bearer <admin_token>
```

### 请求参数
```json
{
  "action": "approved",
  "comment": "审核通过"
}
```

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": null,
  "timestamp": "2025-07-16T10:30:00Z"
}
```

## 13. 拒绝车辆审核

### 接口地址
`POST /api/admin/vehicles/review/{id}`

### 请求头
```
Authorization: Bearer <admin_token>
```

### 请求参数
```json
{
  "action": "rejected",
  "comment": "行驶证信息不清晰，请重新上传"
}
```

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": null,
  "timestamp": "2025-07-16T10:30:00Z"
}

## 14. 获取车辆审核详情

### 接口地址
`GET /api/vehicles/pending/{id}`

### 请求头
```
Authorization: Bearer <user_token>
```

### 权限说明
- 用户可以查看本人的车辆审核详情
- 管理员可以查看所有车辆审核详情

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": {
    "id": 1,
    "driver_id": "driver_123",
    "plate_number": "浙A12345",
    "vehicle_type": "轿车",
    "brand": "大众",
    "model_name": "帕萨特",
    "color": "黑色",
    "year": 2020,
    "registration_image": "https://example.com/registration.jpg",
    "insurance_expiry": "2026-07-16T00:00:00Z",
    "status": "pending",
    "comment": "",
    "submit_time": "2025-07-16T10:30:00Z"
  },
  "timestamp": "2025-07-16T10:30:00Z"
}
```

## 15. 获取当前用户个人信息

### 接口地址
`GET /api/users/profile`

### 请求头
```
Authorization: Bearer <user_token>
```

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": {
    "id": 1,
    "role_id": 1,
    "nick_name": "张三",
    "avatar_url": "https://example.com/avatar.jpg",
    "open_id": "openid_123"
  },
  "timestamp": "2025-07-16T10:30:00Z"
}

## 16. 获取司机信息

### 接口地址
`GET /api/users/drivers` 或 `GET /api/users/drivers/{id}`

### 请求头
```
Authorization: Bearer <user_token>
```

### 请求参数（查询特定司机时）
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | int | 是 | 司机ID |

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": {
    "id": 1,
    "open_id": "openid_123",
    "license_number": "330100199001011234",
    "name": "李四",
    "phone": "139****8765",
    "license_image_url": "https://example.com/license.jpg",
    "status": "approved"
  },
  "timestamp": "2025-07-16T10:30:00Z"
}

### 权限说明
- 所有登录用户都可以查看司机信息

## 17. 封禁司机

### 接口地址
`PUT /api/users/drivers/{id}/ban`

### 请求头
```
Authorization: Bearer <admin_token>
```

### 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | int | 是 | 司机ID |

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": null,
  "timestamp": "2025-07-16T10:30:00Z"
}
```

### 权限说明
- 仅管理员可以调用此接口

## 18. 解封司机

### 接口地址
`PUT /api/users/drivers/{id}/unban`

### 请求头
```
Authorization: Bearer <admin_token>
```

### 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | int | 是 | 司机ID |

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": null,
  "timestamp": "2025-07-16T10:30:00Z"
}
```

### 权限说明
- 仅管理员可以调用此接口

## 19. 获取车辆列表

### 接口地址
`GET /api/vehicles`

### 请求头
```
Authorization: Bearer <user_token>
```

### 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| page | int | 否 | 页码，默认为1 |
| page_size | int | 否 | 每页数量，默认为10 |
| plate_number | string | 否 | 车牌号码，支持模糊查询 |
| brand | string | 否 | 车辆品牌，支持模糊查询 |
| model_name | string | 否 | 车辆型号，支持模糊查询 |
| status | string | 否 | 车辆状态(pending/approved/rejected) |

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": {
    "vehicles": [
      {
        "id": "vehicle_1",
        "driver_id": "driver_123",
        "plate_number": "浙A12345",
        "vehicle_type": "轿车",
        "brand": "大众",
        "model": "帕萨特",
        "status": "approved",
        "submit_time": "2025-07-16T10:30:00Z",
        "review_time": "2025-07-16T11:30:00Z"
      }
    ],
    "pagination": {
      "current_page": 1,
      "page_size": 10,
      "total_count": 1,
      "total_pages": 1
    }
  },
  "timestamp": "2025-07-16T10:30:00Z"
}
```

### 权限说明
- 司机可以查看自己的车辆信息
- 管理员可以查看所有车辆信息

## 20. 获取车辆详情

### 接口地址
`GET /api/vehicles/{vehicle_id}`

### 请求头
```
Authorization: Bearer <user_token>
```

### 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| vehicle_id | string | 是 | 车辆ID |

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": {
    "id": "vehicle_1",
    "driver_id": "driver_123",
    "plate_number": "浙A12345",
    "vehicle_type": "轿车",
    "brand": "大众",
    "model": "帕萨特",
    "status": "approved",
    "submit_time": "2025-07-16T10:30:00Z",
    "review_time": "2025-07-16T11:30:00Z"
  },
  "timestamp": "2025-07-16T10:30:00Z"
}
```

### 权限说明
- 司机可以查看自己的车辆信息
## 21. 删除车辆

### 接口地址
`DELETE /api/admin/vehicles/{vehicle_id}`

### 请求头
```
Authorization: Bearer <admin_token>
```

### 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| vehicle_id | string | 是 | 车辆ID |

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": null,
  "timestamp": "2025-07-16T10:30:00Z"
}
```

### 权限说明
- 仅管理员可以调用此接口
- 管理员可以查看所有车辆信息

## 22. 更新当前用户个人信息

### 接口地址
`PUT /api/users/profile`

### 请求头
```
Authorization: Bearer <user_token>
```

### 请求参数
参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
nick_name | string | 否 | 用户昵称 |
avatar_url | string | 否 | 用户头像URL |

### 请求示例
```json
{
  "nick_name": "新昵称",
  "avatar_url": "https://example.com/new_avatar.jpg"
}
```

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": null,
  "timestamp": "2025-07-16T10:30:00Z"
}
```

### 权限说明
- 所有登录用户都可以调用此接口
- 用户只能更新自己的信息

## 23. 重置当前用户个人信息

### 接口地址
`PUT /api/users/profile/reset`

### 请求头
```
Authorization: Bearer <user_token>
```

### 请求参数
无

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": null,
  "timestamp": "2025-07-16T10:30:00Z"
}
```

### 权限说明
- 所有登录用户都可以调用此接口
- 用户只能重置自己的信息

## 24. 管理员重置用户个人信息

### 接口地址
`PUT /api/users/profile/reset/{id}`

### 请求头
```
Authorization: Bearer <admin_token>
```

### 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | int | 是 | 用户ID |

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": null,
  "timestamp": "2025-07-16T10:30:00Z"
}
```

### 权限说明
- 仅管理员可以调用此接口
- 管理员可以重置任意用户的信息

## 25. 获取司机名下车辆列表

### 接口地址
`GET /api/users/drivers/{id}/vehicles`

### 请求头
```
Authorization: Bearer <user_token>
```

### 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | int | 是 | 司机ID |

### 响应示例
```json
{
  "code": 200,
  "msg": "Success",
  "data": {
    "vehicles": [
      {
        "id": "vehicle_1",
        "driver_id": "driver_123",
        "plate_number": "浙A12345",
        "vehicle_type": "轿车",
        "brand": "大众",
        "model": "帕萨特",
        "status": "approved",
        "submit_time": "2025-07-16T10:30:00Z",
        "review_time": "2025-07-16T11:30:00Z"
      }
    ]
  },
  "timestamp": "2025-07-16T10:30:00Z"
}
```

### 权限说明
- 所有登录用户都可以查看司机名下的车辆信息
